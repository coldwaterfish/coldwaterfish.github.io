### 渲染流程

#### 设计理念

```js
跨平台渲染=>虚拟DOM
快速响应=>异步可中断+增量更新
```

#### 流程

```js
// 首次渲染
React 的主要工作就是将 React.render 接收到的 VNode 转化 Fiber 树，
并根据 Fiber 树的层级关系，构建生成出 DOM 树并渲染至屏幕中
```

```js
// 更新渲染
Fiber 树已经存在于内存中了
所以 React 更关心的是计算出 Fiber 树中的各个节点的差异，并将变化更新到屏幕中
```

#### Fiber 

```js
React的渲染分为协调和提交两个阶段，
协调就是遍历dom树，进行domdiff，收集差异的阶段。
提交就是修改真实dom，进行页面绘制的阶段。
```

```js
virtualDOM:React 15旧的协调算法
Fiber:React 16 中新的协调算法
```

```js
Fiber 协调器的主要目标是增量渲染，更好更平滑地渲染 UI 动画和手势，以及用户互动的响应性。
协调器还允许你将工作分为多个块，并将渲染工作分为多个帧。
它还增加了为每个工作单元定义优先级的能力，以及暂停、重复使用和中止工作的能力
React 的其他一些特性包括从一个渲染函数返回多个元素，
支持更好的错误处理（我们可以使用 componentDidCatch 方法来获得更清晰的错误信息），以及 portals
在计算新的渲染更新时，React 会多次回访主线程。
因此，高优先级的工作可以跳过低优先级的工作。React 在内部为每个更新定义了优先级
```

#### 两个阶段

```js
为了实现 concurrent 模式，React 将渲染更新的过程分为了两个阶段：

1.render 阶段，利用双缓冲技术，在内存中构造另一颗 Fiber 树，
在其上进行协调计算，找到需要更新的节点并记录，这个过程会被重复中断恢复执行。
2.commit 阶段，根据 render 阶段的计算结果，执行更新操作，这个过程是同步执行的
```

